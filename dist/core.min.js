(function(){"use strict";var t=angular.module("ar.core",[]);t.provider("arSettings",function(){var t={server:{protocol:"http",port:"8080",socketPort:"9277",host:"dev.addictradio.net",path:"/api/1"},playerName:null,coverPreload:{background:{width:500,height:500,blurRadius:70},thumb:{width:300,height:300,blurRadius:0}}};this.setOptions=function(e){t=angular.extend(t,e)},this.$get=[function(){if(!t.playerName)throw new Error("You must set a playerName value for ar.core with arSettingsProvider.setOption() in angular config phase");return t.endpoint=function(){return t.server.protocol+"://"+t.server.host+(t.server.port?":"+t.server.port:":80")+t.server.path}(),t.socket=function(){return t.server.protocol+"://"+t.server.host+":"+t.server.socketPort}(),t}]})}).call(this),function(){"use strict";var t=angular.module("ar.core");t.factory("arAudioPlayer",["$interval","$timeout","arSettings","arChannel",function(t,e,n,r){function i(){this.audio=new Audio,this._lastChunk=0,this._currentChannel=null,this._watchPromise=null;var e=this;n.autoLoadChannel&&r.promise.then(function(){var t=r.find(n.autoLoadChannel);if(!t){var i=r.list().length,o=Math.floor(Math.random()*(i+1));t=r.list()[o]}e.setChannel(t),n.autoPlay&&e.play()}),angular.element(this.audio).on("timeupdate",function(t){0!==e._lastChunk&&(e._lastChunk=t.timeStamp)}),t(function(){e.isPlaying=Date.now()-e._lastChunk<2e3,e.isLoading=e._lastChunk===1/0,0===e._lastChunk||e.isPlaying||e._restart()},250)}return i.prototype.play=function(){return this._loadSource(),this.audio.play(),this._lastChunk=1/0,this._watchLoading(),this},i.prototype.stop=function(){return this.audio.pause(),this._unloadSource(),this._lastChunk=0,this},i.prototype.getVolume=function(){return parseInt(100*this.audio.volume)},i.prototype.setVolume=function(t){return t=parseInt(t),"number"==typeof t&&isFinite(t)&&t>=0&&100>=t?this.audio.volume=t/100:console.error("Volume must be a number between 0 and 100 (was: "+t+")"),this},i.prototype.getChannel=function(){return this._currentChannel},i.prototype.setChannel=function(t){return this._currentChannel=t,this},i.prototype.getMeta=function(){return this.getChannel()?this.getChannel().meta():void 0},i.prototype.getCoverData=function(t){return this.getMeta()&&this.getMeta().cover?this.getMeta().cover.base64(t):void 0},i.prototype.getCoverLightness=function(){return this.getMeta()&&this.getMeta().cover?this.getMeta().cover.lightness:void 0},i.prototype._watchLoading=function(t){this._watchPromise&&e.cancel(this._watchPromise);var n=this;n._watchPromise=e(function(){n.isLoading&&(n.stop(),n.isLoading=!1,n._restart(),n._watchPromise=null)},5e3)},i.prototype._restart=function(){this.isLoading||this.play()},i.prototype._loadSource=function(){this._unloadSource();var t=this._currentChannel?this._currentChannel.sources():void 0;if(!t)throw new Error("_currentChannel is undefined. Use setChannel method.");for(var e=t.length-1;e>=0;e--){var n=t[e],r=document.createElement("source");this.audio.appendChild(r),r.src=n}return this.audio.load(),this},i.prototype._unloadSource=function(){for(;this.audio.firstChild;)this.audio.removeChild(this.audio.firstChild);return this},new i}]),t.directive("arPlay",["arAudioPlayer",function(t){return{scope:{channel:"="},link:function(e,n,r){n.on("click",function(n){n.preventDefault(),t.setChannel(e.channel||t.getChannel()),t.play()})}}}]),t.directive("arStop",["arAudioPlayer",function(t){return{link:function(e,n,r){n.on("click",function(e){e.preventDefault(),t.stop()})}}}]),t.directive("arVolume",["arAudioPlayer",function(t){return{template:'<input type="range" min="0" max="100" ng-model="volume">',scope:{},restrict:"E",link:function(e,n,r){e.volume=t.getVolume(),n.on("input change",function(){t.setVolume(e.volume)})}}}])}.call(this),function(){"use strict";var t=angular.module("ar.core");t.factory("arChannel",["$http","arSettings","arMeta",function(t,e,n){function r(t){this.name=t.name,this.tag=t.tag,this.theme=t.theme,this.streams=t.streams}var i=[];r.prototype.sources=function(){return this.streams.filter(function(t){return"online"===t.status}).map(function(t){return t.url+"?amsparams=playerid:"+e.playerName+";skey:"+parseInt(Date.now()/1e3)+";"})},r.prototype.meta=function(){return n.find(this.tag)};var o=t.get(e.endpoint+"/channels",{});return o.then(function(t){for(var e=t.data.response.length-1;e>=0;e--)i.push(new r(t.data.response[e]))},function(t){console.error(t)}),{list:function(){return i},find:function(t){return i.filter(function(e){return e.tag===t})[0]},promise:o}}])}.call(this),function(){"use strict";var t=angular.module("ar.core");t.factory("arCover",["$q","arSettings",function(t,e){function n(n){this.source=n,this.image=new Image,this.image.src=this.source+"?"+(new Date).getTime(),this.image.crossOrigin="Anonymous";var r=t.defer();this.promise=r.promise,this._exports={};var i=this;this.image.onload=function(){if(i.getLightness(),e.coverPreload)for(var t=Object.keys(e.coverPreload),n=t.length-1;n>=0;n--){var o=t[n],a=e.coverPreload[o];i["export"](o,a.width,a.height,a.blurRadius)}r.resolve(i)}}function r(t){this.source=t,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}return n.prototype.base64=function(t){return this._exports[t]?this._exports[t].getBase64():void 0},n.prototype["export"]=function(t,e,n,i){if(n=n||(e?e*(this.image.naturalHeight/this.image.naturalWidth):this.image.naturalHeight),e=e||this.image.naturalWidth,this._exports[t])return this._exports[t];var o=new r(this);return o.draw(e,n),parseFloat(i)&&o.blur(parseFloat(i)),this._exports[t]=o,this._exports[t]},n.prototype.getLightness=function(){for(var t,e,n,i,o=20,a=new r(this).draw(o,o).getImageData().data,s=0,u=0,h=a.length;h>u;u+=4)t=a[u],e=a[u+1],n=a[u+2],i=Math.floor((t+e+n)/3),s+=i;var c=Math.floor(s/Math.pow(o,2));return this.lightness=c},r.prototype.draw=function(t,e){return this.canvas.style.width=(this.canvas.width=t)+"px",this.canvas.style.height=(this.canvas.height=e)+"px",this.ctx.drawImage(this.source.image,0,0,t,e),this},r.prototype.blur=function(t){function e(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var n=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],r=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];if(!(isNaN(t)||1>t)){t|=0;var i,o,a,s,u,h,c,l,p,f,g,d,m,v,y,_,w,C,x,b,k=0,P=0,S=this.canvas.width,M=this.canvas.height,D=this.ctx.getImageData(k,P,S,M),L=D.data,I=t+t+1,$=S-1,q=M-1,N=t+1,A=N*(N+1)/2,V=new e,E=V;for(a=1;I>a;a++)if(E=E.next=new e,a==N)var O=E;E.next=V;var R=null,F=null;c=h=0;var B=n[t],H=r[t];for(o=0;M>o;o++){for(v=y=_=l=p=f=0,g=N*(w=L[h]),d=N*(C=L[h+1]),m=N*(x=L[h+2]),l+=A*w,p+=A*C,f+=A*x,E=V,a=0;N>a;a++)E.r=w,E.g=C,E.b=x,E=E.next;for(a=1;N>a;a++)s=h+((a>$?$:a)<<2),l+=(E.r=w=L[s])*(b=N-a),p+=(E.g=C=L[s+1])*b,f+=(E.b=x=L[s+2])*b,v+=w,y+=C,_+=x,E=E.next;for(R=V,F=O,i=0;S>i;i++)L[h]=l*B>>H,L[h+1]=p*B>>H,L[h+2]=f*B>>H,l-=g,p-=d,f-=m,g-=R.r,d-=R.g,m-=R.b,s=c+((s=i+t+1)<$?s:$)<<2,v+=R.r=L[s],y+=R.g=L[s+1],_+=R.b=L[s+2],l+=v,p+=y,f+=_,R=R.next,g+=w=F.r,d+=C=F.g,m+=x=F.b,v-=w,y-=C,_-=x,F=F.next,h+=4;c+=S}for(i=0;S>i;i++){for(y=_=v=p=f=l=0,h=i<<2,g=N*(w=L[h]),d=N*(C=L[h+1]),m=N*(x=L[h+2]),l+=A*w,p+=A*C,f+=A*x,E=V,a=0;N>a;a++)E.r=w,E.g=C,E.b=x,E=E.next;for(u=S,a=1;t>=a;a++)h=u+i<<2,l+=(E.r=w=L[h])*(b=N-a),p+=(E.g=C=L[h+1])*b,f+=(E.b=x=L[h+2])*b,v+=w,y+=C,_+=x,E=E.next,q>a&&(u+=S);for(h=i,R=V,F=O,o=0;M>o;o++)s=h<<2,L[s]=l*B>>H,L[s+1]=p*B>>H,L[s+2]=f*B>>H,l-=g,p-=d,f-=m,g-=R.r,d-=R.g,m-=R.b,s=i+((s=o+N)<q?s:q)*S<<2,l+=v+=R.r=L[s],p+=y+=R.g=L[s+1],f+=_+=R.b=L[s+2],R=R.next,g+=w=F.r,d+=C=F.g,m+=x=F.b,v-=w,y-=C,_-=x,F=F.next,h+=S}return this.ctx.putImageData(D,k,P),this}},r.prototype.getBase64=function(){return this.canvas.toDataURL()},r.prototype.getImageData=function(){return this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height)},n}])}.call(this),function(){"use strict";var t=angular.module("ar.core");t.factory("arMeta",["$http","$q","arSettings","arSocket","arCover",function(t,e,n,r,i){function o(t){if(this.played_on=t.played_on,this.played_at=t.played_at,this.req_artist=t.req_artist,this.req_title=t.req_title,this.song=t.song,this.promise=e.defer(),this.song){if(this.song.album&&this.song.album.cover_url){this.cover=new i(this.song.album.cover_url);var n=this;this.cover.promise.then(function(){n.promise.resolve()})}}else this.clean(),this.promise.resolve()}var a={};o.prototype.fullName=function(t){return this.song.name+(t||" â€” ")+this.song.artist.name},o.prototype.clean=function(){this.song={name:this.req_title,artist:{name:this.req_artist}}};var s=t.get(n.endpoint+"/plays",{});return s.then(function(t){for(var e=t.data.response.length-1;e>=0;e--)a[t.data.response[e].played_on]=new o(t.data.response[e])},function(t){console.error(t)}),r.on("play:update",function(t){e.defer();a[t.played_on]=new o(t)}),{find:function(t){return a[t]},promise:s}}])}.call(this),function(){"use strict";var t=angular.module("ar.core");t.factory("arSocket",["$rootScope","arSettings",function(t,e){var n=io.connect(e.socket);return{on:function(e,r){n.on(e,function(){var e=arguments;t.$apply(function(){r.apply(n,e)})})},emit:function(e,r,i){n.emit(e,r,function(){var e=arguments;t.$apply(function(){i&&i.apply(n,e)})})}}}])}.call(this);