(function(){"use strict";var t=angular.module("ar.core",[]);t.provider("arSettings",function(){var t={protocol:"http",port:"8080",socketPort:"9277",host:"dev.addictradio.net",path:"/api/1",playerName:null};this.setOptions=function(n){t=angular.extend(t,n)},this.$get=[function(){if(!t.playerName)throw new Error("You must set a playerName value for ar.core with arSettingsProvider.setOption() in angular config phase");return t.endpoint=function(){return t.protocol+"://"+t.host+(t.port?":"+t.port:":80")+t.path}(),t.socket=function(){return t.protocol+"://"+t.host+":"+t.socketPort}(),t}]})}).call(this),function(){"use strict";var t=angular.module("ar.core");t.factory("arAudioPlayer",["$interval","$timeout",function(t,n){function e(){this.audio=new Audio,this._lastChunk=0,this._currentChannel=null,this._watchPromise=null;var n=this;angular.element(n.audio).on("timeupdate",function(t){0!==n._lastChunk&&(n._lastChunk=t.timeStamp)}),t(function(){n.isPlaying=Date.now()-n._lastChunk<2e3,n.isLoading=n._lastChunk===1/0,0===n._lastChunk||n.isPlaying||n._restart()},250)}return e.prototype.play=function(){return this._loadSource(),this.audio.play(),this._lastChunk=1/0,this._watchLoading(),this},e.prototype.stop=function(){return this.audio.pause(),this._unloadSource(),this._lastChunk=0,this},e.prototype.getVolume=function(){return parseInt(100*this.audio.volume)},e.prototype.setVolume=function(t){return t=parseInt(t),"number"==typeof t&&isFinite(t)&&t>=0&&100>=t?this.audio.volume=t/100:console.error("Volume must be a number between 0 and 100 (was: "+t+")"),this},e.prototype.getChannel=function(){return this._currentChannel},e.prototype.setChannel=function(t){return this._currentChannel=t,this},e.prototype._watchLoading=function(t){this._watchPromise&&n.cancel(this._watchPromise);var e=this;e._watchPromise=n(function(){e.isLoading&&(e.stop(),e.isLoading=!1,e._restart(),e._watchPromise=null)},5e3)},e.prototype._restart=function(){this.isLoading||this.play()},e.prototype._loadSource=function(){this._unloadSource();var t=this._currentChannel?this._currentChannel.sources():void 0;if(!t)throw new Error("_currentChannel is undefined. Use setChannel method.");for(var n=t.length-1;n>=0;n--){var e=t[n],r=document.createElement("source");this.audio.appendChild(r),r.src=e}return this.audio.load(),this},e.prototype._unloadSource=function(){for(;this.audio.firstChild;)this.audio.removeChild(this.audio.firstChild);return this},new e}]),t.directive("arPlay",["arAudioPlayer",function(t){return{scope:{channel:"="},link:function(n,e,r){e.on("click",function(e){e.preventDefault(),t.setChannel(n.channel||t.getChannel()),t.play()})}}}]),t.directive("arStop",["arAudioPlayer",function(t){return{link:function(n,e,r){e.on("click",function(n){n.preventDefault(),t.stop()})}}}]),t.directive("arVolume",["arAudioPlayer",function(t){return{template:'<input type="range" min="0" max="100" ng-model="volume">',scope:{},restrict:"E",link:function(n,e,r){n.volume=t.getVolume(),e.on("input change",function(){t.setVolume(n.volume)})}}}])}.call(this),function(){"use strict";var t=angular.module("ar.core");t.factory("arChannel",["$http","arSettings","arMeta",function(t,n,e){function r(t){this.name=t.name,this.tag=t.tag,this.theme=t.theme,this.streams=t.streams}var o=[];r.prototype.sources=function(){return this.streams.filter(function(t){return"online"===t.status}).map(function(t){return t.url+"?amsparams=playerid:"+n.playerName+";skey:"+parseInt(Date.now()/1e3)+";"})},r.prototype.meta=function(){return e.find(this.tag)};var i=t.get(n.endpoint+"/channels",{});return i.then(function(t){for(var n=t.data.response.length-1;n>=0;n--)o.push(new r(t.data.response[n]))},function(t){console.error(t)}),{list:function(){return o},find:function(t){return o.filter(function(n){return n.tag===t})},promise:i}}])}.call(this),function(){"use strict";function t(t){this.played_on=t.played_on,this.played_at=t.played_at,this.req_artist=t.req_artist,this.req_title=t.req_title,this.song=t.song,this._clean()}var n=angular.module("ar.core");t.prototype.cover=function(){return this.song.album?this.song.album.cover_url:void 0},t.prototype.fullName=function(t){return this.song.name+(t||" â€” ")+this.song.artist.name},t.prototype._clean=function(){null==this.song&&(this.song={name:this.req_title,artist:{name:this.req_artist}})},n.factory("arMeta",["$http","$q","arSettings","arSocket",function(n,e,r,o){var i={},a=n.get(r.endpoint+"/plays",{});return a.then(function(n){for(var e=n.data.response.length-1;e>=0;e--)i[n.data.response[e].played_on]=new t(n.data.response[e])},function(t){console.error(t)}),o.on("play:update",function(n){var r,o,a=e.defer();if(r=null!=(o=n.song)?o.album.cover_url:void 0){var u=new Image;u.src=r,u.onload=a.resolve}else a.resolve();a.promise.then(function(){i[n.played_on]=new t(n)})}),{find:function(t){return i[t]},promise:a}}])}.call(this),function(){"use strict";var t=angular.module("ar.core");t.factory("arSocket",["$rootScope","arSettings",function(t,n){var e=io.connect(n.socket);return{on:function(n,r){e.on(n,function(){var n=arguments;t.$apply(function(){r.apply(e,n)})})},emit:function(n,r,o){e.emit(n,r,function(){var n=arguments;t.$apply(function(){o&&o.apply(e,n)})})}}}])}.call(this);