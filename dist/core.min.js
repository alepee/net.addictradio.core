(function(){"use strict";var t=angular.module("ar.core",[]);t.provider("arSettings",function(){var t={server:{protocol:"http",port:"8080",socketPort:"9277",host:"dev.addictradio.net",path:"/api/1"},playerName:null,coverPreload:{background:{width:500,height:500,blurRadius:70},thumb:{width:300,height:300,blurRadius:0}}};this.setOptions=function(e){t=angular.extend(t,e)},this.$get=[function(){if(!t.playerName)throw new Error("You must set a playerName value for ar.core with arSettingsProvider.setOption() in angular config phase");return t.endpoint=function(){return t.server.protocol+"://"+t.server.host+(t.server.port?":"+t.server.port:":80")+t.server.path}(),t.socket=function(){return t.server.protocol+"://"+t.server.host+":"+t.server.socketPort}(),t}]})}).call(this),function(){"use strict";var t=angular.module("ar.core");t.service("arAudioPlayer",["$interval","$timeout","arSettings","arChannel",function(t,e,n,i){this.audio=new Audio,this._lastChunk=0,this._currentChannel=null,this._watchPromise=null,n.autoLoadChannel&&i.promise.then(function(){var t=i.find(n.autoLoadChannel);if(!t){var e=Math.floor(Math.random()*i.list().length);t=i.list()[e]}this.setChannel(t),n.autoPlay&&this.play()}.bind(this)),angular.element(this.audio).on("timeupdate",function(t){0!==this._lastChunk&&(this._lastChunk=t.timeStamp)}.bind(this)),t(function(){this.isPlaying=Date.now()-this._lastChunk<2e3,this.isLoading=this._lastChunk===1/0,0===this._lastChunk||this.isPlaying||this._restart()}.bind(this),250),this.play=function(){return this._loadSource(),this.audio.play(),this._lastChunk=1/0,this._watchLoading(),this},this.stop=function(){return this.audio.pause(),this._unloadSource(),this._lastChunk=0,this},this.getVolume=function(){return parseInt(100*this.audio.volume)},this.setVolume=function(t){return t=parseInt(t),"number"==typeof t&&isFinite(t)&&t>=0&&100>=t?this.audio.volume=t/100:console.error("Volume must be a number between 0 and 100 (was: "+t+")"),this},this.getChannel=function(){return this._currentChannel},this.setChannel=function(t){return this._currentChannel=t,this},this.getMeta=function(){return this.getChannel()?this.getChannel().meta():void 0},this.getCover=function(t){if(this.getMeta()&&this.getMeta().cover){var e=this.getMeta().cover;return t?e.base64(t):e.source}},this.getCoverLightness=function(){return this.getMeta()&&this.getMeta().cover?this.getMeta().cover.lightness:void 0},this.getCoverLightnessWord=function(){var t=this.getCoverLightness();return t?this.getCoverLightness()<128?"dark":"light":void 0},this.getTheme=function(){return this.getChannel()?this.getChannel().theme:void 0},this._watchLoading=function(t){this._watchPromise&&e.cancel(this._watchPromise),this._watchPromise=e(function(){this.isLoading&&(this.stop(),this.isLoading=!1,this._restart(),this._watchPromise=null)}.bind(this),5e3)},this._restart=function(){this.isLoading||this.play()},this._loadSource=function(){this._unloadSource();var t=this._currentChannel?this._currentChannel.sources():void 0;if(!t)throw new Error("_currentChannel is undefined. Use setChannel method.");for(var e=t.length-1;e>=0;e--){var n=t[e],i=document.createElement("source");this.audio.appendChild(i),i.src=n}return this.audio.load(),this},this._unloadSource=function(){for(;this.audio.firstChild;)this.audio.removeChild(this.audio.firstChild);return this}}]),t.directive("arPlay",["arAudioPlayer",function(t){return{scope:{channel:"="},link:function(e,n,i){n.on("click",function(n){n.preventDefault(),t.setChannel(e.channel||t.getChannel()),t.play()})}}}]),t.directive("arStop",["arAudioPlayer",function(t){return{link:function(e,n,i){n.on("click",function(e){e.preventDefault(),t.stop()})}}}]),t.directive("arVolume",["arAudioPlayer",function(t){return{template:'<input type="range" min="0" max="100" ng-model="volume">',scope:{},restrict:"E",link:function(e,n,i){e.volume=t.getVolume(),n.on("input change",function(){t.setVolume(e.volume)})}}}])}.call(this),function(){"use strict";var t=angular.module("ar.core");t.factory("arChannel",["$http","arSettings","arMeta",function(t,e,n){function i(t){this.name=t.name,this.tag=t.tag,this.theme=t.theme,this.streams=t.streams}var r=[];i.prototype.sources=function(){return this.streams.filter(function(t){return"online"===t.status}).map(function(t){return t.url+"?amsparams=playerid:"+e.playerName+";skey:"+parseInt(Date.now()/1e3)+";"})},i.prototype.meta=function(){return n.find(this.tag)};var s=t.get(e.endpoint+"/channels",{});return s.then(function(t){for(var e=t.data.response.length-1;e>=0;e--)r.push(new i(t.data.response[e]))},function(t){console.error(t)}),{promise:s,list:function(){return r},find:function(t){return r.filter(function(e){return e.tag===t})[0]}}}])}.call(this),function(){"use strict";var t=angular.module("ar.core");t.factory("arCover",["$q","arSettings",function(t,e){function n(n){this.source=n,this.image=new Image,this.image.src=this.source+"?"+(new Date).getTime(),this.image.crossOrigin="Anonymous";var i=t.defer();this.promise=i.promise,this._exports={},this.image.onload=function(){if(this.getLightness(),e.coverPreload)for(var t=Object.keys(e.coverPreload),n=t.length-1;n>=0;n--){var r=t[n],s=e.coverPreload[r];this["export"](r,s.width,s.height,s.blurRadius)}i.resolve(this)}.bind(this)}function i(t){this.source=t,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}return n.prototype.base64=function(t){return this._exports[t]?this._exports[t].getBase64():void 0},n.prototype["export"]=function(t,e,n,r){if(n=n||(e?e*(this.image.naturalHeight/this.image.naturalWidth):this.image.naturalHeight),e=e||this.image.naturalWidth,this._exports[t])return this._exports[t];var s=new i(this);return s.draw(e,n),parseFloat(r)&&s.blur(parseFloat(r)),this._exports[t]=s,this._exports[t]},n.prototype.getLightness=function(){for(var t,e,n,r,s=20,a=new i(this).draw(s,s).getImageData().data,o=0,h=0,u=a.length;u>h;h+=4)t=a[h],e=a[h+1],n=a[h+2],r=Math.floor((t+e+n)/3),o+=r;var c=Math.floor(o/Math.pow(s,2));return this.lightness=c},i.prototype.draw=function(t,e){return this.canvas.style.width=(this.canvas.width=t)+"px",this.canvas.style.height=(this.canvas.height=e)+"px",this.ctx.drawImage(this.source.image,0,0,t,e),this},i.prototype.blur=function(t){function e(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var n=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],i=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];if(!(isNaN(t)||1>t)){t|=0;var r,s,a,o,h,u,c,l,g,f,p,d,v,m,y,_,C,w,b,x,k=0,P=0,S=this.canvas.width,L=this.canvas.height,M=this.ctx.getImageData(k,P,S,L),D=M.data,I=t+t+1,$=S-1,q=L-1,N=t+1,A=N*(N+1)/2,V=new e,E=V;for(a=1;I>a;a++)if(E=E.next=new e,a==N)var O=E;E.next=V;var R=null,F=null;c=u=0;var W=n[t],B=i[t];for(s=0;L>s;s++){for(m=y=_=l=g=f=0,p=N*(C=D[u]),d=N*(w=D[u+1]),v=N*(b=D[u+2]),l+=A*C,g+=A*w,f+=A*b,E=V,a=0;N>a;a++)E.r=C,E.g=w,E.b=b,E=E.next;for(a=1;N>a;a++)o=u+((a>$?$:a)<<2),l+=(E.r=C=D[o])*(x=N-a),g+=(E.g=w=D[o+1])*x,f+=(E.b=b=D[o+2])*x,m+=C,y+=w,_+=b,E=E.next;for(R=V,F=O,r=0;S>r;r++)D[u]=l*W>>B,D[u+1]=g*W>>B,D[u+2]=f*W>>B,l-=p,g-=d,f-=v,p-=R.r,d-=R.g,v-=R.b,o=c+((o=r+t+1)<$?o:$)<<2,m+=R.r=D[o],y+=R.g=D[o+1],_+=R.b=D[o+2],l+=m,g+=y,f+=_,R=R.next,p+=C=F.r,d+=w=F.g,v+=b=F.b,m-=C,y-=w,_-=b,F=F.next,u+=4;c+=S}for(r=0;S>r;r++){for(y=_=m=g=f=l=0,u=r<<2,p=N*(C=D[u]),d=N*(w=D[u+1]),v=N*(b=D[u+2]),l+=A*C,g+=A*w,f+=A*b,E=V,a=0;N>a;a++)E.r=C,E.g=w,E.b=b,E=E.next;for(h=S,a=1;t>=a;a++)u=h+r<<2,l+=(E.r=C=D[u])*(x=N-a),g+=(E.g=w=D[u+1])*x,f+=(E.b=b=D[u+2])*x,m+=C,y+=w,_+=b,E=E.next,q>a&&(h+=S);for(u=r,R=V,F=O,s=0;L>s;s++)o=u<<2,D[o]=l*W>>B,D[o+1]=g*W>>B,D[o+2]=f*W>>B,l-=p,g-=d,f-=v,p-=R.r,d-=R.g,v-=R.b,o=r+((o=s+N)<q?o:q)*S<<2,l+=m+=R.r=D[o],g+=y+=R.g=D[o+1],f+=_+=R.b=D[o+2],R=R.next,p+=C=F.r,d+=w=F.g,v+=b=F.b,m-=C,y-=w,_-=b,F=F.next,u+=S}return this.ctx.putImageData(M,k,P),this}},i.prototype.getBase64=function(){return this.canvas.toDataURL()},i.prototype.getImageData=function(){return this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height)},n}])}.call(this),function(){"use strict";var t=angular.module("ar.core");t.factory("arMeta",["$http","$q","arSettings","arSocket","arCover",function(t,e,n,i,r){function s(t){var n=e.defer();this.played_on=t.played_on,this.played_at=t.played_at,this.req_artist=t.req_artist,this.req_title=t.req_title,this.song=t.song,this.promise=n.promise,this.song?this.song.album&&this.song.album.cover_url&&(this.cover=new r(this.song.album.cover_url),this.cover.promise.then(function(){this.promise.resolve()}.bind(this))):(this.clean(),this.promise.resolve())}var a={};s.prototype.fullName=function(t){return this.song.name+(t||" — ")+this.song.artist.name},s.prototype.clean=function(){this.song={name:this.req_title,artist:{name:this.req_artist}}};var o=t.get(n.endpoint+"/plays",{});return o.then(function(t){for(var e=t.data.response.length-1;e>=0;e--)a[t.data.response[e].played_on]=new s(t.data.response[e])},function(t){console.error(t)}),i.on("play:update",function(t){var n=(e.defer(),new s(t));n.promise.then(function(){a[t.played_on]=n})}),{find:function(t){return a[t]},promise:o}}])}.call(this),function(){"use strict";var t=angular.module("ar.core");t.service("arSocket",["$rootScope","arSettings",function(t,e){var n=io.connect(e.socket);this.on=function(e,i){n.on(e,function(){var e=arguments;t.$apply(function(){i.apply(n,e)})})},this.emit=function(e,i,r){n.emit(e,i,function(){var e=arguments;t.$apply(function(){r&&r.apply(n,e)})})}}])}.call(this);